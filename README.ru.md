# Утилита для создания моков классов

[EN](README.md)

## Описание

Утилита предназначена для автоматической генерации "оболочек" классов (моков) из исходного кода PHP. Она позволяет:

- Оставлять только публичные методы классов.
- Очищать тела методов, чтобы подготовить их для использования в тестах.
- Сохранять преобразованные файлы в структуру директорий, соответствующую стандарту PSR-4.

Этот инструмент особенно полезен для тестирования сложных систем, где:

- Невозможно или затруднительно использовать стандартные средства создания моков (например, PHPUnit).
- Отсутствует поддержка Dependency Injection.
- Не полностью реализован стандарт PSR-4.

После обработки классов вы можете добавить специальный трейт к сгенерированным мокам, чтобы управлять их поведением при
тестировании.

## Установка

```bash
composer require --dev voral/mock-builder
```

## Использование

### Через командную строку

Вы можете запустить утилиту с помощью команды:

```bash
php bin/vs-mock-builder.php [опции]
```

#### Доступные опции:

- `-i, --file <path>`: Указать путь к PHP-файлу для обработки.
- `-d, --dir <path>`: Указать путь к директории, содержащей PHP-файлы для обработки.
- `-b, --base <path>`: Указать базовый путь для исходных файлов (по умолчанию текущая рабочая директория).
- `-t, --target <path>`: Указать целевой путь для сохранения сгенерированных моков (по умолчанию `./target/`).
- `-f, --filter <filter>`: Указать фильтр для выбора классов по имени (через запятую).
- `-h, --help`: Вывести справку.

Примеры:

```bash
# Обработка одного файла
php bin/vs-mock-builder.php -i=/path/to/file.php -t=/custom/target/dir/ -f=Manager,Service

# Обработка всех файлов в директории
php bin/vs-mock-builder.php -d=/path/to/directory -t=/custom/target/dir/ -f=Controller
```

### Через конфигурационный файл

Вы можете создать конфигурационный файл `.vs-mock-builder.php` в корне проекта. Пример содержимого:

```php
<?php

declare(strict_types=1);

return [
    'directoryPath' => '/',
    'basePath' => '/path/to/source/',
    'targetPath' => __DIR__ . '/target/',
    'classNameFilter' => [
        'Application',
    ],
];
```

Если конфигурационный файл существует, его значения используются как параметры по умолчанию. При этом параметры,
переданные через командную строку, имеют приоритет.

## Особенности работы

1. **Обработка интерфейсов и классов**:
    - Утилита поддерживает как классы, так и интерфейсы.
    - Для каждого класса или интерфейса создаётся отдельный файл в целевой директории.

2. **Фильтрация классов**:
    - Вы можете указать список подстрок для фильтрации классов по имени.
    - Если фильтр не указан, будут обработаны все классы.

3. **Сохранение в PSR-4**:
    - Преобразованные файлы сохраняются в структуру директорий, соответствующую пространству имён класса.

4. **Очистка методов**:
    - Все публичные методы остаются в классе, но их тела очищаются (удаляется содержимое).

## Требования

- PHP >= 8.1
- Composer

## Лицензия

Проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).